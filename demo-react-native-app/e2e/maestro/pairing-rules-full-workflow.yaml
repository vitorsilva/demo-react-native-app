# Maestro E2E test for Full Pairing Rules Workflow
# Tests complete workflow: add good pair, add avoid pair, verify tabs, delete rules
#
# Prerequisites:
#   - Android emulator running: adb devices
#   - App installed (see MAESTRO_TESTING.md for options)
#
# Run with: maestro test e2e/maestro/pairing-rules-full-workflow.yaml

appId: com.vitorsilvavmrs.saborspin
---
# Clear app state for consistent testing
- clearState
# Launch app
- launchApp

# Verify home screen loads
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 30000

# Navigate to Settings tab
- tapOn: "Settings"

# Wait for settings screen to load
- extendedWaitUntil:
    visible: "Settings"
    timeout: 10000

# Scroll to find Pairing Rules
- scrollUntilVisible:
    element: "Pairing Rules"
    direction: DOWN
    timeout: 10000

# Navigate to Pairing Rules screen
- tapOn: "Pairing Rules"

# Wait for Pairing Rules screen to load
- extendedWaitUntil:
    visible: "Good Pairs"
    timeout: 10000

# Take screenshot of initial state
- takeScreenshot: pairing-workflow-01-initial

# Step 1: Add a good pair (milk + cereals)
- assertVisible: "No good pairs defined yet"
- tapOn: "Add Good Pair"

# Wait for modal
- extendedWaitUntil:
    visible: "First ingredient"
    timeout: 5000

# Select first ingredient
- tapOn: "Select ingredient..."
- extendedWaitUntil:
    visible: "First ingredient"
    timeout: 5000
- tapOn: "milk"

# Select second ingredient
- extendedWaitUntil:
    visible: "Second ingredient"
    timeout: 5000
- tapOn:
    text: "Select ingredient..."
    index: 0
- extendedWaitUntil:
    visible: "Second ingredient"
    timeout: 5000
- tapOn: "cereals"

# Save the rule
- extendedWaitUntil:
    visible: "Add"
    timeout: 5000
- tapOn: "Add"

# Wait for modal to close
- extendedWaitUntil:
    notVisible: "pairs well with"
    timeout: 5000
- waitForAnimationToEnd

# Verify good pair was added
- assertVisible: "milk"
- assertVisible: "cereals"
- assertNotVisible: "No good pairs defined yet"

# Take screenshot of good pair added
- takeScreenshot: pairing-workflow-02-good-pair-added

# Step 2: Switch to Avoid tab and add an avoid pair (butter + yogurt)
- tapOn:
    text: ".*Avoid.*"

# Wait for UI to update
- waitForAnimationToEnd

# Verify Avoid tab empty state
- assertVisible: "No avoid rules defined yet"

# Take screenshot of avoid tab empty
- takeScreenshot: pairing-workflow-03-avoid-empty

# Add avoid pair
- tapOn: "Add Pair to Avoid"

# Wait for modal
- extendedWaitUntil:
    visible: "First ingredient"
    timeout: 5000

# Select first ingredient
- tapOn: "Select ingredient..."
- extendedWaitUntil:
    visible: "First ingredient"
    timeout: 5000
- tapOn: "butter"

# Select second ingredient
- extendedWaitUntil:
    visible: "Second ingredient"
    timeout: 5000
- tapOn:
    text: "Select ingredient..."
    index: 0
- extendedWaitUntil:
    visible: "Second ingredient"
    timeout: 5000
- tapOn: "yogurt"

# Save the rule
- extendedWaitUntil:
    visible: "Add"
    timeout: 5000
- tapOn: "Add"

# Wait for modal to close
- extendedWaitUntil:
    notVisible: "should avoid"
    timeout: 5000
- waitForAnimationToEnd

# Verify avoid pair was added
- assertVisible: "butter"
- assertVisible: "yogurt"
- assertNotVisible: "No avoid rules defined yet"

# Take screenshot of avoid pair added
- takeScreenshot: pairing-workflow-04-avoid-pair-added

# Step 3: Verify tab switching shows correct rules
# Switch back to Good Pairs tab
- tapOn:
    text: ".*Good Pairs.*"

# Wait for UI to update
- waitForAnimationToEnd

# Verify good pair is still visible
- assertVisible: "milk"
- assertVisible: "cereals"

# Take screenshot of good pairs tab
- takeScreenshot: pairing-workflow-05-good-pairs-tab

# Switch back to Avoid tab
- tapOn:
    text: ".*Avoid.*"

# Wait for UI to update
- waitForAnimationToEnd

# Verify avoid pair is visible
- assertVisible: "butter"
- assertVisible: "yogurt"

# Take screenshot of avoid tab with rule
- takeScreenshot: pairing-workflow-06-avoid-tab-with-rule

# Step 4: Delete the avoid pair
- tapOn: "Delete"

# Wait for confirmation dialog
- extendedWaitUntil:
    visible:
      text: ".*delete.*"
    timeout: 5000

# Take screenshot of delete confirmation
- takeScreenshot: pairing-workflow-07-delete-confirm

# Confirm deletion
- tapOn: "Delete"

# Wait for deletion to complete
- waitForAnimationToEnd

# Verify empty state returns
- extendedWaitUntil:
    visible: "No avoid rules defined yet"
    timeout: 5000

- assertVisible: "No avoid rules defined yet"

# Take screenshot after delete
- takeScreenshot: pairing-workflow-08-after-delete

# Verify good pair still exists in Good Pairs tab
- tapOn:
    text: ".*Good Pairs.*"
- waitForAnimationToEnd
- assertVisible: "milk"
- assertVisible: "cereals"

# Take final screenshot
- takeScreenshot: pairing-workflow-09-complete

# Test passed - Full pairing rules workflow completed successfully

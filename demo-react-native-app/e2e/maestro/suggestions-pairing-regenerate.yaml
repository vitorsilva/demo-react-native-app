# Maestro E2E test for Regenerating Suggestions without Negative Pairs
# Tests that regenerating suggestions still respects negative pairing rules
#
# Prerequisites:
#   - Android emulator running: adb devices
#   - App installed (see MAESTRO_TESTING.md for options)
#
# Run with: maestro test e2e/maestro/suggestions-pairing-regenerate.yaml

appId: com.vitorsilvavmrs.saborspin
---
# Clear app state for consistent testing
- clearState
# Launch app
- launchApp

# Verify home screen loads
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 30000

# Step 1: Navigate to Settings tab and add negative pairing rule
- tapOn: "Settings"

# Wait for settings screen to load
- extendedWaitUntil:
    visible: "Settings"
    timeout: 10000

# Scroll to find Pairing Rules
- scrollUntilVisible:
    element: "Pairing Rules"
    direction: DOWN
    timeout: 10000

# Navigate to Pairing Rules screen
- tapOn: "Pairing Rules"

# Wait for Pairing Rules screen to load
- extendedWaitUntil:
    visible: "Good Pairs"
    timeout: 10000

# Switch to Avoid tab
- tapOn:
    text: ".*Avoid.*"

# Wait for UI to update
- waitForAnimationToEnd

# Add avoid pair: milk + cereals
- tapOn: "Add Pair to Avoid"

# Wait for modal
- extendedWaitUntil:
    visible: "First ingredient"
    timeout: 5000

# Select first ingredient - milk
- tapOn: "Select ingredient..."
- extendedWaitUntil:
    visible: "First ingredient"
    timeout: 5000
- tapOn: "milk"

# Select second ingredient - cereals
- extendedWaitUntil:
    visible: "Second ingredient"
    timeout: 5000
- tapOn:
    text: "Select ingredient..."
    index: 0
- extendedWaitUntil:
    visible: "Second ingredient"
    timeout: 5000
- tapOn: "cereals"

# Save the rule
- extendedWaitUntil:
    visible: "Add"
    timeout: 5000
- tapOn: "Add"

# Wait for modal to close
- extendedWaitUntil:
    notVisible: "should avoid"
    timeout: 5000
- waitForAnimationToEnd

# Verify avoid pair was added
- assertVisible: "milk"
- assertVisible: "cereals"

# Navigate back to home
- tapOn: "Back"

# Wait for settings screen
- extendedWaitUntil:
    visible: "Settings"
    timeout: 10000

# Navigate to Home tab
- tapOn: "Home"

# Wait for home screen
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 10000

# Step 2: Navigate to Breakfast suggestions
- tapOn: "Breakfast ideas"

# Wait for suggestions to load
- extendedWaitUntil:
    visible: "Select"
    timeout: 15000

# Take screenshot of initial suggestions
- takeScreenshot: suggestions-regenerate-01-initial

# Step 3: Regenerate suggestions multiple times
# First regeneration
- tapOn: "Generate New Ideas"

# Wait for suggestions to reload
- extendedWaitUntil:
    visible: "Select"
    timeout: 15000

# Verify suggestions are still displayed
- assertVisible: "Select"

# Take screenshot after first regeneration
- takeScreenshot: suggestions-regenerate-02-first

# Second regeneration
- tapOn: "Generate New Ideas"

# Wait for suggestions to reload
- extendedWaitUntil:
    visible: "Select"
    timeout: 15000

# Verify suggestions are still displayed
- assertVisible: "Select"

# Take screenshot after second regeneration
- takeScreenshot: suggestions-regenerate-03-second

# Third regeneration
- tapOn: "Generate New Ideas"

# Wait for suggestions to reload
- extendedWaitUntil:
    visible: "Select"
    timeout: 15000

# Verify suggestions are still displayed
- assertVisible: "Select"

# Take screenshot after third regeneration
- takeScreenshot: suggestions-regenerate-04-third

# Test passed - Regenerating suggestions still respects negative pairing rules

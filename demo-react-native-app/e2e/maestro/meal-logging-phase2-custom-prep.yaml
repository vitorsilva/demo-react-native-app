# Maestro E2E test for Phase 2 Custom Preparation Method
# Tests adding a custom preparation method during meal logging
#
# Prerequisites:
#   - Android emulator running: adb devices
#   - App installed (see MAESTRO_TESTING.md for options)
#
# Run with: maestro test e2e/maestro/meal-logging-phase2-custom-prep.yaml

appId: com.vitorsilvavmrs.saborspin
---
# Launch app
- launchApp

# Verify home screen loads
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 30000

# Take screenshot of initial home screen
- takeScreenshot: phase2-custom-01-home

# Navigate to breakfast suggestions
- tapOn:
    text: "breakfast Ideas"
    optional: false

# Wait for suggestions screen to load
- extendedWaitUntil:
    visible: "Pick one:"
    timeout: 15000

# Select first suggestion to open confirmation modal
- tapOn:
    text: "Select"
    index: 0

# Wait for confirmation modal
- extendedWaitUntil:
    visible: "Done"
    timeout: 10000

# Scroll to see ingredients
- scroll

# Wait for UI to settle
- waitForAnimationToEnd

# Open preparation method picker for first ingredient (search for "as is")
- tapOn:
    text: "as is"
    index: 0

# Wait for prep method picker to appear - look for Grilled as indicator picker is open
- extendedWaitUntil:
    visible: "Grilled"
    timeout: 10000

# Take screenshot before adding custom method
- takeScreenshot: phase2-custom-02-picker-before

# Scroll down in picker to find Add custom option
- scroll

# Wait a moment for the scroll to settle
- waitForAnimationToEnd

# Tap "Add custom" button to show input field (using partial match)
- tapOn:
    text: "Add custom"

# Wait for custom input field to appear
- extendedWaitUntil:
    visible: "Add"
    timeout: 5000

# Enter custom preparation method name in the input field
- inputText: "air-fried"

# Take screenshot with custom method input
- takeScreenshot: phase2-custom-03-input-filled

# Tap Add button to add the custom method
- tapOn: "Add"

# Wait for picker to close and return to confirmation modal
- extendedWaitUntil:
    visible: "Done"
    timeout: 5000

# Verify custom method is now shown on the component row
- assertVisible: "air-fried"

# Take screenshot showing custom preparation method selected
- takeScreenshot: phase2-custom-04-custom-selected

# Complete the logging
- tapOn: "Done"

# Wait to return to home screen
- extendedWaitUntil:
    visible: "Recent Meals"
    timeout: 10000

# Take screenshot of home after logging with custom prep method
- takeScreenshot: phase2-custom-05-home-after

# Test passed - Adding custom preparation method works on mobile

# Maestro E2E test for telemetry functionality
# Verifies app doesn't crash during telemetry operations on mobile
#
# Run with: maestro test e2e/maestro/telemetry-flow.yaml

appId: com.vitorsilvavmrs.saborspin
---
# Launch app
- launchApp

# Verify home screen loads (telemetry initializes on app start)
- assertVisible: "SaborSpin"

# Navigate to breakfast suggestions (triggers screen tracking)
- tapOn: "breakfast Ideas"

# Wait for suggestions screen
- assertVisible: "Breakfast Suggestions"

# Scroll down to find the Generate button
- scroll

# Generate new suggestions (triggers perf logging)
- tapOn:
    id: "generate-new-ideas-button"

# Wait for animation/loading
- waitForAnimationToEnd

# Verify suggestions loaded (telemetry didn't crash the app)
- assertVisible: "Pick one:"

# Tap on first meal card (triggers action logging)
- tapOn:
    id: "suggestion-0"

# Verify selection worked
- assertVisible: "Select"

# Tap select button
- tapOn:
    id: "select-button-0"

# Verify confirmation modal (meal logging action tracked)
- extendedWaitUntil:
    visible:
      text: ".*Logged.*"
    timeout: 10000

# Dismiss modal
- tapOn:
    id: "done-button"

# Verify we're back on home
- assertVisible: "Recent Meals"

# Navigate to History tab (triggers screen tracking)
- tapOn: "History"
- assertVisible: "Today"

# Navigate to Settings tab (triggers screen tracking)
- tapOn: "Settings"
- assertVisible: "Global Preferences"

# Navigate back to Home
- tapOn: "Home"
- assertVisible: "SaborSpin"

# If we got here, telemetry didn't cause any crashes

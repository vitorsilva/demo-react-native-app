# Maestro E2E test for telemetry functionality
# Verifies app doesn't crash during telemetry operations on mobile
#
# Prerequisites:
#   - Android emulator running: adb devices
#   - App installed (see MAESTRO_TESTING.md for options)
#
# Run with: maestro test e2e/maestro/telemetry-flow.yaml

appId: com.vitorsilvavmrs.saborspin
---
# Launch app
- launchApp

# Verify home screen loads (telemetry initializes on app start)
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 30000

# Take screenshot of home screen
- takeScreenshot: telemetry-home

# Verify key home screen elements are visible
- assertVisible: "breakfast Ideas"
- assertVisible: "snack Ideas"

# Navigate to breakfast suggestions (triggers screen tracking)
- tapOn:
    text: "breakfast Ideas"
    optional: false

# Wait for suggestions screen to load
- extendedWaitUntil:
    visible: "Pick one:"
    timeout: 15000

# Take screenshot of suggestions
- takeScreenshot: telemetry-suggestions

# Verify suggestions screen elements
- assertVisible: "Pick one:"
- assertVisible: "Select"

# Select a meal (triggers action logging)
- tapOn:
    text: "Select"
    index: 0

# Wait for confirmation modal
- extendedWaitUntil:
    visible: "Breakfast Logged"
    timeout: 10000

# Take screenshot of confirmation
- takeScreenshot: telemetry-confirmation

# Verify confirmation modal elements
- assertVisible: "Breakfast Logged"
- assertVisible: "Enjoy your meal!"
- assertVisible: "Done"

# Dismiss modal by tapping Done button
- tapOn: "Done"

# Verify we're back on home
- extendedWaitUntil:
    visible: "Recent Meals"
    timeout: 10000

# Navigate to History tab (triggers screen tracking)
- tapOn: "History"
- extendedWaitUntil:
    visible: ".*History.*|.*Today.*|.*logged.*"
    timeout: 10000

# Take screenshot of history
- takeScreenshot: telemetry-history

# Verify history screen elements
- assertVisible: "Today"
- assertVisible: "Breakfast"

# Navigate to Settings tab (triggers screen tracking)
- tapOn: "Settings"
- extendedWaitUntil:
    visible: ".*Settings.*|.*Preferences.*|.*Cooldown.*"
    timeout: 10000

# Take screenshot of settings
- takeScreenshot: telemetry-settings

# Verify settings screen elements
- assertVisible: "Settings"
- assertVisible: "Variety Cooldown"
- assertVisible: "Number of Suggestions"

# Navigate back to Home
- tapOn: "Home"
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 10000

# Take final screenshot
- takeScreenshot: telemetry-complete

# If we got here, telemetry didn't cause any crashes

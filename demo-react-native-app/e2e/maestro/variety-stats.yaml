# Maestro E2E test for Variety Stats feature
# Verifies stats card visibility and collapse/expand functionality on mobile
#
# Prerequisites:
#   - Android emulator running: adb devices
#   - App installed (see MAESTRO_TESTING.md for options)
#
# Run with: maestro test e2e/maestro/variety-stats.yaml

appId: com.vitorsilvavmrs.saborspin
---
# Launch app with cleared state for consistent testing
- clearState
- launchApp

# Wait for app to load
- extendedWaitUntil:
    visible: "SaborSpin"
    timeout: 30000

# Take screenshot of initial home screen
- takeScreenshot: variety-stats-01-home-initial

# Verify the variety stats card is visible on home screen
- assertVisible:
    id: "variety-stats-card"

# Verify the stats card title is visible
- assertVisible: "Your Variety This Month"

# Take screenshot showing stats card
- takeScreenshot: variety-stats-02-stats-card-visible

# Verify content is visible (card is expanded by default)
- assertVisible:
    id: "variety-stats-content"

# Since no meals are logged, verify empty state message
- assertVisible: "No meals logged yet"

# Take screenshot of empty state
- takeScreenshot: variety-stats-03-empty-state

# Test collapse functionality - tap the toggle
- tapOn:
    id: "variety-stats-toggle"

# Wait for animation
- waitForAnimationToEnd

# Verify content is no longer visible (card is collapsed)
- assertNotVisible:
    id: "variety-stats-content"

# Take screenshot of collapsed state
- takeScreenshot: variety-stats-04-collapsed

# Test expand functionality - tap the toggle again
- tapOn:
    id: "variety-stats-toggle"

# Wait for animation
- waitForAnimationToEnd

# Verify content is visible again
- assertVisible:
    id: "variety-stats-content"

# Take screenshot of expanded state
- takeScreenshot: variety-stats-05-expanded-again

# Now log a meal to verify stats update
- tapOn:
    text: "Breakfast"
    optional: false

# Wait for suggestions screen
- extendedWaitUntil:
    visible: "Pick one:"
    timeout: 15000

# Take screenshot of suggestions
- takeScreenshot: variety-stats-06-suggestions

# Select first suggestion
- tapOn:
    id: "select-button-0"

# Wait for confirmation modal
- extendedWaitUntil:
    visible: "Logged"
    timeout: 10000

# Dismiss modal
- tapOn:
    id: "done-button"

# Wait to return to home screen
- extendedWaitUntil:
    visible: "Your Variety This Month"
    timeout: 10000

# Verify stats card is still visible after navigation
- assertVisible:
    id: "variety-stats-card"

# Verify stats have updated (should show at least 1 combination now)
- assertVisible:
    id: "variety-stats-content"

# Take screenshot of stats after logging meal
- takeScreenshot: variety-stats-07-stats-after-meal

# Test passed - variety stats feature works on mobile
